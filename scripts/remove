#!/bin/bash

#=================================================
# GENERIC STARTING
#=================================================
# IMPORT GENERIC HELPERS
#=================================================

source _common.sh
source /usr/share/yunohost/helpers

#=================================================
# LOAD SETTINGS
#=================================================

app=$YNH_APP_INSTANCE_NAME

domain=$(ynh_app_setting_get $app domain)


# Stop service radciale
# And delete service in Yunohost
sudo yunohost service stop $app
sudo yunohost service remove $app
sudo systemctl disable $app



if [ -h "/etc/systemd/system/$app.service" ]; then
	echo "Delete systemd unit"
	ynh_secure_remove "etc/systemd/system/$app.service"
fi

rm -fr /var/log/$app

#=================================================
# REMOVE DEPENDENCIES
#=================================================

ynh_remove_app_dependencies

#=================================================
# REMOVE THE MAIN DIR OF THE APP
#=================================================

ynh_secure_remove "/opt/yunohost/$app"	# Suppression du dossier de l'application
ynh_secure_remove "/home/$app"

#=================================================
# REMOVE THE NGINX CONFIGURATION
#=================================================

ynh_remove_nginx_config	# Suppression de la configuration nginx

#=================================================
# REMOVE THE LOGROTATE CONFIG
#=================================================

ynh_remove_logrotate	# Suppression de la configuration de logrotate

#=================================================
# SPECIFIC REMOVE
#=================================================
# REMOVE RADICALE'S CONFIG
#=================================================

ynh_secure_remove "/etc/$app"	# Delete radicale config

#=================================================

#=================================================
# GENERIC FINALISATION
#=================================================
# REMOVE DEDICATED USER
#=================================================

ynh_system_user_delete $app
